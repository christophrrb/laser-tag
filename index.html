<html>

<body>
	<p id="startLat">1</p>
	<p id="startLon">1</p>
	<p id="heading">1</p>
	<p id="distance">1</p>
	<p id="headingTo">1</p>
	<script>
		window.addEventListener('deviceorientation', function (evt) {
			if (event.webkitCompassHeading) {
				heading = event.webkitCompassHeading;
				console.log("ios");
				document.getElementById('heading').innerHTML = heading.toFixed(0);
			} else {
				console.log("no");
				document.getElementById('heading').innerHTML = "heading";
			}
			return heading;

		}, false);

		class Player {
			constructor(lat, long, direction) {
				this.lat = lat;
				this.long = long;
				this.direction = direction;
			}
		}
		var radius = 6371009
		var distance;
		var myLocation;
		window.onload = function () {
			var Pos;
			var geoOptions = {
				enableHighAccuracy: true
			}

			var geoSuccess = function (position) {

				Pos = position;
				myLocation = position;
				document.getElementById('startLat').innerHTML = (Pos.coords.latitude * (Math.PI / 180)).toFixed(7);
				document.getElementById('startLon').innerHTML = (Pos.coords.longitude * (Math.PI / 180)).toFixed(7);
				Denis.lat = parseInt((Pos.coords.latitude * (Math.PI / 180)).toFixed(7));
				Denis.long = parseInt((Pos.coords.longitude * (Math.PI / 180)).toFixed(7));
				console.log(getDistance(Denis, Jack));
				angleTo(Denis, Jack);
				document.getElementById('distance').innerHTML = getDistance(Denis, Jack);
				document.getElementById('headingTo').innerHTML = angleTo(Denis, Jack);
			};
			var geoError = function (error) {
				console.log('Error occurred. Error code: ' + error.code);
				location.href = '/oops.html';
				// error.code can be:
				//   0: unknown error
				//   1: permission denied
				//   2: position unavailable (error response from location provider)
				//   3: timed out
			};

			navigator.geolocation.watchPosition(geoSuccess, geoError, geoOptions);
		}
		function getDistance(player1, player2) {

			void function distVincenty(lat1, lon1, lat2, lon2) {
				var a = 6378137,
					b = 6356752.3142,
					f = 1 / 298.257223563, // WGS-84 ellipsoid params
					L = lon2 - lon1,
					U1 = Math.atan((1 - f) * Math.tan(lat1)),
					U2 = Math.atan((1 - f) * Math.tan(lat2)),
					sinU1 = Math.sin(U1),
					cosU1 = Math.cos(U1),
					sinU2 = Math.sin(U2),
					cosU2 = Math.cos(U2),
					lambda = L,
					lambdaP,
					iterLimit = 100;
				do {
					var sinLambda = Math.sin(lambda),
						cosLambda = Math.cos(lambda),
						sinSigma = Math.sqrt((cosU2 * sinLambda) * (cosU2 * sinLambda) + (cosU1 * sinU2 - sinU1 * cosU2 * cosLambda) * (cosU1 * sinU2 - sinU1 * cosU2 * cosLambda));
					if (0 === sinSigma) {
						return 0; // co-incident points
					};
					var cosSigma = sinU1 * sinU2 + cosU1 * cosU2 * cosLambda,
						sigma = Math.atan2(sinSigma, cosSigma),
						sinAlpha = cosU1 * cosU2 * sinLambda / sinSigma,
						cosSqAlpha = 1 - sinAlpha * sinAlpha,
						cos2SigmaM = cosSigma - 2 * sinU1 * sinU2 / cosSqAlpha,
						C = f / 16 * cosSqAlpha * (4 + f * (4 - 3 * cosSqAlpha));
					if (isNaN(cos2SigmaM)) {
						cos2SigmaM = 0; // equatorial line: cosSqAlpha = 0 (ยง6)
					};
					lambdaP = lambda;
					lambda = L + (1 - C) * f * sinAlpha * (sigma + C * sinSigma * (cos2SigmaM + C * cosSigma * (-1 + 2 * cos2SigmaM * cos2SigmaM)));
				} while (Math.abs(lambda - lambdaP) > 1e-12 && --iterLimit > 0);

				if (!iterLimit) {
					return NaN; // formula failed to converge
					console.log(NaN);
				};

				var uSq = cosSqAlpha * (a * a - b * b) / (b * b),
					A = 1 + uSq / 16384 * (4096 + uSq * (-768 + uSq * (320 - 175 * uSq))),
					B = uSq / 1024 * (256 + uSq * (-128 + uSq * (74 - 47 * uSq))),
					deltaSigma = B * sinSigma * (cos2SigmaM + B / 4 * (cosSigma * (-1 + 2 * cos2SigmaM * cos2SigmaM) - B / 6 * cos2SigmaM * (-3 + 4 * sinSigma * sinSigma) * (-3 + 4 * cos2SigmaM * cos2SigmaM))),
					s = b * A * (sigma - deltaSigma);
				console.log(s);
				distance = parseInt(s.toFixed(3)); // round to 1mm precision

			}
			return (distance);

		};


		function angleTo(player1, player2) {
			var distanceLat = radius * Math.sqrt(Math.pow((Math.abs(player1.lat - player2.lat)), 2));
			var distanceLong = radius * Math.sqrt(Math.pow(Math.cos((player1.lat + player2.lat) / 2) * (Math.abs(player1.long - player2.long)), 2))
			var angle = Math.atan(distanceLong / distanceLat) * (180 / Math.PI);
			console.log(angle);
			return angle;

		}
		var Denis = new Player(0, 0, 0);
		var Jack = new Player(0.5935904, -1.4742820, .001);
	</script>
</body>

</html>