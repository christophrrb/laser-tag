<html>

<body>
	<p id="startLat">1</p>
	<p id="startLon">1</p>
	<p id="heading">1</p>
	<p id="distance">1</p>
	<p id="headingTo">1</p>
	<script>
		window.addEventListener('deviceorientation', function (evt) {
			if (event.webkitCompassHeading) {
				heading = event.webkitCompassHeading;
				console.log("ios");
				document.getElementById('heading').innerHTML = heading;
			} else {
				console.log("no");
				document.getElementById('heading').innerHTML = "heading";
			}
			return heading;

		}, false);

		class Player {
			constructor(lat, long, direction) {
				this.lat = lat;
				this.long = long;
				this.direction = direction;
			}
		}
		var radius = 6371009
		var myLocation;
		window.onload = function () {
			var Pos;
			var geoOptions = {
				enableHighAccuracy: true
			}

			var geoSuccess = function (position) {

				Pos = position;
				myLocation = position;
				document.getElementById('startLat').innerHTML = Pos.coords.latitude * (Math.PI / 180);
				document.getElementById('startLon').innerHTML = Pos.coords.longitude * (Math.PI / 180);
				Denis.lat = Pos.coords.latitude * (Math.PI / 180);
				Denis.long = Pos.coords.longitude * (Math.PI / 180);
				console.log(Denis.lat + "" + Denis.long + "" + Denis.direction);
				getDistance(Denis, Jack);
				angleTo(Denis, Jack);
				document.getElementById('distance').innerHTML = getDistance(Denis, Jack);
				document.getElementById('headingTo').innerHTML = angleTo(Denis, Jack);
			};
			var geoError = function (error) {
				console.log('Error occurred. Error code: ' + error.code);
				location.href = '/oops.html';
				// error.code can be:
				//   0: unknown error
				//   1: permission denied
				//   2: position unavailable (error response from location provider)
				//   3: timed out
			};

			navigator.geolocation.watchPosition(geoSuccess, geoError, geoOptions);
		}
		function getDistance(player1, player2) {
			var distanceLat = Math.abs(player1.lat - player2.lat);
			var distanceLong = Math.abs(player1.long - player2.long);
			var distance = radius * Math.sqrt(Math.pow(distanceLat, 2) + Math.pow(Math.cos((player1.lat + player2.lat) / 2) * (distanceLong), 2))
			console.log(distance);
			return distance;
		}
		function angleTo(player1, player2) {
			var distanceLat = radius * Math.sqrt(Math.pow((Math.abs(player1.lat - player2.lat)), 2));
			var distanceLong = radius * Math.sqrt(Math.pow(Math.cos((player1.lat + player2.lat) / 2) * (Math.abs(player1.long - player2.long)), 2))
			var angle = Math.atan(distanceLong / distanceLat) * (180 / Math.PI);
			console.log(angle);
			return angle;

		}
		var Denis = new Player(0, 0, 0);
		var Jack = new Player(.5935905918541774, -1.4742805835115, .001);
		getDistance(Denis, Jack);
		angleTo(Denis, Jack);

	</script>
</body>

</html>